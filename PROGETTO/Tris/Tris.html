<!doctype html>

<html>
<head>
<title>Tris</title>
<meta charset="UTF-8">

<style>
	td{
		border:3px solid black;
		border: collapse;
		text-align:center;
		height: 70px;
		width: 70px;
		font-size: 40px;
		background-color: grey;
	}
	
	th{
		border:3px solid black;
		text-align:center;
		height: 70px;
		width: 70px;
		font-size: 70px;
		background-color: grey;
	}
	
	tr{
		border: none;
	}
	
	table{
		width: 400px;
		height: 550px;
		margin: auto;
	}
</style>

</head>

<body>
		<p>Sfida <u>Mario</u> a tris! Il riquadro in alto indica di chi è il turno: Mario è un gentiluomo e fare cominciare te per primo, ma se perdi comincerà lui. Mario ha il simbolo <b>O</b>, mentre tu <b>X</b>.</p>

		<table>
			<tr>
				<th colspan="3" id="titolo">Tocca a te!</th>
			</tr>
			
			<tr>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			 
			<tr>
				<td></td>
				<td></td>
				<td></td>
			</tr>
			
			<tr>
				<td></td>
				<td></td>
				<td></td>
			</tr>
		</table>
		
		<button id="reset">Reset</button>

   
   
    <script>
	
		//variabili
		let caselle = document.getElementsByTagName("td");
		let titolo = document.getElementById("titolo");
		let win = false; //variabile utilizzata per controllare se qualcuno ha gia vinto o no (usata anche nel pareggio)
		
		
		//onMouseOver per tutti i td
		for(var i=0; i<(caselle.length); i++)
		{
			caselle[i].onmouseover=rosso;
			caselle[i].onmouseout=torna;
			caselle[i].onclick=cambioTurno;
		}
		
		function rosso(e)
		{
			e.target.style.backgroundColor="red";
		}
		
		function torna(e)
		{
			e.target.style.backgroundColor="grey";
		}
		
		
		//cambio del titolo e inserimento del segno nel posto scelto
		function cambioTurno(e)
		{ 
			if(e.target.innerHTML=="")
			{
				if(titolo.innerHTML=="Tocca a te!") 
				{
					titolo.innerHTML="Tocca a Mario!";
					e.target.innerHTML="X"
					setTimeout(turnoMario, 1500);
				}
				else 
				{
					alert("Non barare! E' il turno di Mario")
				}
			}
			else alert("CELLA GIA' SCELTA!");

			checkVittoria();
			checkPareggio();
		}

		function turnoMario(){ //turno di Mario
			let sceltaMario = 0;
			if(titolo.innerHTML=="Tocca a Mario!"){
				do{
					sceltaMario = Math.floor(Math.random()*9);
					console.log(sceltaMario);
				}while(caselle[sceltaMario].innerHTML!=""); 

				caselle[sceltaMario].innerHTML="O";
				titolo.innerHTML="Tocca a te!"

				checkVittoria();
				checkPareggio();
			}
		}
		
		function checkVittoria() { //controllo condizioni di vittoria e decisione del vincitore, se presente
			win = false;
			let simbolo = 'X';

			for (let i = 0; i<2; i++) { 
				if (i === 1) simbolo = 'O';
				if (caselle[0].innerHTML === simbolo && caselle[1].innerHTML === simbolo && caselle[2].innerHTML === simbolo) {
					winner = simbolo;
					win = true;
				}
				else if (caselle[3].innerHTML === simbolo && caselle[4].innerHTML === simbolo && caselle[5].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
				else if (caselle[6].innerHTML === simbolo && caselle[7].innerHTML === simbolo && caselle[8].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
				else if (caselle[0].innerHTML === simbolo && caselle[3].innerHTML === simbolo && caselle[6].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
				else if (caselle[1].innerHTML === simbolo && caselle[4].innerHTML === simbolo && caselle[7].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
				else if (caselle[2].innerHTML === simbolo && caselle[5].innerHTML === simbolo && caselle[8].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
				else if (caselle[0].innerHTML === simbolo && caselle[4].innerHTML === simbolo && caselle[8].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
				else if (caselle[2].innerHTML === simbolo && caselle[4].innerHTML === simbolo && caselle[6].innerHTML === simbolo){
					winner = simbolo;
					win = true;
				}
			}

			if (win) {//alert per vittoria
				if(winner == 'X')alert("Hai vinto!");
				else alert("Ha vinto Mario!");
				
				resetTotale();
			}
		}

		function checkPareggio(){
			if(!win){
				let pareggio=true;
				for (let i in caselle) {
					if(caselle[i].innerHTML == "")pareggio=false;
				}
				if(pareggio)alert("Pareggio!");
			}
		}

		document.getElementById("reset").onclick = resetTotale; //reset
		
		function resetTotale() {
			for (let i in caselle) {
				caselle[i].innerHTML = "";
			}
		}
    </script>
</body>
</html>